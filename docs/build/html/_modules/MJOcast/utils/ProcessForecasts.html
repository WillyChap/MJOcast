

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>MJOcast.utils.ProcessForecasts &mdash; MJOcast 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'0.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> MJOcast
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MJOcast</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>MJOcast.utils.ProcessForecasts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for MJOcast.utils.ProcessForecasts</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">eofs.standard</span> <span class="k">as</span> <span class="nn">Eof_st</span>
<span class="kn">from</span> <span class="nn">eofs.multivariate.standard</span> <span class="kn">import</span> <span class="n">MultivariateEof</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">MJOcast.utils.WHtools</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">interpolate_obs</span><span class="p">,</span>
    <span class="n">check_or_create_paths</span><span class="p">,</span>
    <span class="n">convert_dates_to_string</span><span class="p">,</span>
    <span class="n">check_lat_lon_coords</span><span class="p">,</span>
    <span class="n">flip_lat_if_necessary</span><span class="p">,</span>
    <span class="n">switch_lon_to_0_360</span>
<span class="p">)</span>

<div class="viewcode-block" id="make_DF_ense"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.make_DF_ense">[docs]</a><span class="k">def</span> <span class="nf">make_DF_ense</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a DataFrame with files and their corresponding initialization dates.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        files (list): List of file paths.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DF (pd.DataFrame): DataFrame containing files and their initialization dates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">yr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;File&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">})</span>

    <span class="c1"># Initialize the &#39;Init&#39; column with file names</span>
    <span class="n">DF</span><span class="p">[</span><span class="s1">&#39;Init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="s1">&#39;File&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">File</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DF</span><span class="p">[</span><span class="s1">&#39;File&#39;</span><span class="p">]):</span>
        <span class="c1"># Extract the initialization date from the file name using the provided function</span>
        <span class="n">inst</span><span class="p">,</span> <span class="n">matches</span> <span class="o">=</span> <span class="n">convert_dates_to_string</span><span class="p">(</span><span class="n">File</span><span class="p">)</span>
        <span class="n">DF</span><span class="p">[</span><span class="s1">&#39;Init&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
    <span class="k">return</span> <span class="n">DF</span>


<div class="viewcode-block" id="MJOforecaster"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster">[docs]</a><span class="k">class</span> <span class="nc">MJOforecaster</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">yaml_file_path</span><span class="p">,</span><span class="n">eof_dict</span><span class="p">,</span><span class="n">MJO_fobs</span><span class="p">):</span>
        
        <span class="c1">#Global attributes that the functions need! </span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">yml_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">yml_data</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">yml_data</span> <span class="o">=</span> <span class="n">yml_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yml_usr_info</span> <span class="o">=</span> <span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;user_defined_info&#39;</span><span class="p">]</span>
        <span class="n">DSforexample</span> <span class="o">=</span> <span class="n">check_or_create_paths</span><span class="p">(</span><span class="n">yml_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forecast_lons</span> <span class="o">=</span> <span class="n">DSforexample</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;base_dir&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eof_dict</span> <span class="o">=</span> <span class="n">eof_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span> <span class="o">=</span> <span class="n">MJO_fobs</span>
        <span class="k">pass</span>
    
    
    
<div class="viewcode-block" id="MJOforecaster.get_forecast_LT_climo"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.get_forecast_LT_climo">[docs]</a>    <span class="k">def</span> <span class="nf">get_forecast_LT_climo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yml_data</span><span class="p">,</span> <span class="n">lons_forecast</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the forecast climatology dataset.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            yml_data (dict): A dictionary containing user-defined information.</span>
<span class="sd">            lons_forecast (array-like): Array of forecast longitudes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DS_climo_forecast (xr.Dataset): Forecast climatology dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract the user-defined information from the input dictionary</span>
        <span class="n">yml_usr_info</span> <span class="o">=</span> <span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;user_defined_info&#39;</span><span class="p">]</span>

        <span class="c1"># Check if the user wants to use the forecast-dependent climatology</span>
        <span class="k">if</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;use_forecast_climo&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using the forecast dependent climatology. Make sure you have generated it using ./Preprocessing_Scripts/*.ipynb.&#39;</span><span class="p">)</span>
            <span class="c1"># Load the forecast climatology dataset</span>
            <span class="n">DS_climo_forecast</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="o">+</span><span class="s1">&#39;/Forecast_Climo/Forecast_Climo.nc&#39;</span><span class="p">)</span>
            <span class="c1">#TODO add an option to generate/use their own forecast climo...</span>
            <span class="n">DS_climo_forecast</span> <span class="o">=</span> <span class="n">interpolate_obs</span><span class="p">(</span><span class="n">DS_climo_forecast</span><span class="p">,</span> <span class="n">lons_forecast</span><span class="p">)</span>  <span class="c1"># Check to make sure this works....</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using the climatology calculated by ERA5. It will be less skillful than a lead time dependent climatology.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generate a lead time dependent climatology in ./Preprocessing_Scripts/*.ipynb for better results.&#39;</span><span class="p">)</span>
            <span class="c1"># Load the ERA5-based forecast climatology dataset</span>
            <span class="n">obs_fp_Ec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;obs_data_loc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ERA5_climo.nc&#39;</span><span class="p">)</span>
            <span class="n">DS_climo_forecast</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">obs_fp_Ec</span><span class="p">)</span>
            <span class="c1"># Interpolate the ERA5-based climatology to match the forecast longitudes</span>
            <span class="n">DS_climo_forecast</span> <span class="o">=</span> <span class="n">interpolate_obs</span><span class="p">(</span><span class="n">DS_climo_forecast</span><span class="p">,</span> <span class="n">lons_forecast</span><span class="p">)</span>  <span class="c1"># Check to make sure this works....</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">DS_climo_forecast</span> <span class="o">=</span> <span class="n">DS_climo_forecast</span></div>
        <span class="k">return</span> <span class="n">DS_climo_forecast</span>


<div class="viewcode-block" id="MJOforecaster.anomaly_LTD"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.anomaly_LTD">[docs]</a>    <span class="k">def</span> <span class="nf">anomaly_LTD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">yml_data</span><span class="p">,</span> <span class="n">DS_CESM_for</span><span class="p">,</span> <span class="n">DS_climo_forecast</span><span class="p">,</span> <span class="n">numdays_out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate anomalies of u850, u200, and OLR from forecast and forecast climatology datasets.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            yml_data (dict): A dictionary containing user-defined information.</span>
<span class="sd">            DS_CESM_for (xr.Dataset): Forecast dataset (CESM format).</span>
<span class="sd">            DS_climo_forecast (xr.Dataset): Forecast climatology dataset.</span>
<span class="sd">            numdays_out (int): Number of forecast days.</span>

<span class="sd">        Returns:</span>
<span class="sd">            U850_cesm_anom (xr.DataArray): Anomalies of u850.</span>
<span class="sd">            U200_cesm_anom (xr.DataArray): Anomalies of u200.</span>
<span class="sd">            OLR_cesm_anom (xr.DataArray): Anomalies of OLR.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">yml_usr_info</span> <span class="o">=</span> <span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;user_defined_info&#39;</span><span class="p">]</span>

        <span class="n">u200vSTR</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u200_name&#39;</span><span class="p">]</span>
        <span class="n">u850vSTR</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u850_name&#39;</span><span class="p">]</span>
        <span class="n">olrvSTR</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_olr_name&#39;</span><span class="p">]</span>

        <span class="c1">#get the day of year of the forecasts</span>
        <span class="n">fordoy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;time.dayofyear&#39;</span><span class="p">])</span>

        <span class="c1"># Convert the &#39;fordoy&#39; numpy array to a DataArray</span>
        <span class="n">fordoy_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">fordoy</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;lead&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lead&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fordoy</span><span class="p">))})</span>
        <span class="c1"># Use .sel() and .drop() with the DataArray fordoy</span>
        <span class="n">DSclimo_doy</span> <span class="o">=</span> <span class="n">DS_climo_forecast</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="n">fordoy_da</span><span class="p">,</span><span class="n">lead</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">numdays_out</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># u850:</span>
        <span class="n">U850_cesm</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">u850vSTR</span><span class="p">]</span>
        <span class="n">U850_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U850_cesm</span><span class="p">)</span>
        <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DSclimo_doy</span><span class="p">[</span><span class="s1">&#39;ua_850&#39;</span><span class="p">])</span>
        <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">temp_clim_u850</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_clim_u850</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">numdays_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">temp_clim_u850</span><span class="p">[:,</span> <span class="p">:</span><span class="n">numdays_out</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">U850_cesm_anom</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_cesm</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp_clim_u850</span>
        <span class="c1"># u200:</span>
        <span class="n">U200_cesm</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">u200vSTR</span><span class="p">]</span>
        <span class="n">U200_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U200_cesm</span><span class="p">)</span>
        <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DSclimo_doy</span><span class="p">[</span><span class="s1">&#39;ua_200&#39;</span><span class="p">])</span>
        <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">temp_clim_u200</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_clim_u200</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">numdays_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">temp_clim_u200</span><span class="p">[:,</span> <span class="p">:</span><span class="n">numdays_out</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">U200_cesm_anom</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_cesm</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp_clim_u200</span>

        <span class="c1"># OLR:</span>
        <span class="n">OLRxr</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">olrvSTR</span><span class="p">]</span>
        <span class="n">OLR_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">olrvSTR</span><span class="p">])</span>
        <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DSclimo_doy</span><span class="p">[</span><span class="s1">&#39;rlut&#39;</span><span class="p">])</span>
        <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">temp_clim_olr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_clim_olr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">numdays_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">temp_clim_olr</span><span class="p">[:,</span> <span class="p">:</span><span class="n">numdays_out</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">OLR_cesm_anom</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLRxr</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp_clim_olr</span>
</div>
        <span class="k">return</span> <span class="n">U850_cesm_anom</span><span class="p">,</span> <span class="n">U200_cesm_anom</span><span class="p">,</span> <span class="n">OLR_cesm_anom</span>


<div class="viewcode-block" id="MJOforecaster.anomaly_ERA5"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.anomaly_ERA5">[docs]</a>    <span class="k">def</span> <span class="nf">anomaly_ERA5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">yml_data</span><span class="p">,</span> <span class="n">DS_CESM_for</span><span class="p">,</span> <span class="n">DS_climo_forecast</span><span class="p">,</span> <span class="n">numdays_out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate anomalies of u850, u200, and OLR from forecast and ERA5 climatology datasets.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            yml_data (dict): A dictionary containing user-defined information.</span>
<span class="sd">            DS_CESM_for (xr.Dataset): Forecast dataset (CESM format).</span>
<span class="sd">            DS_climo_forecast (xr.Dataset): ERA5 climatology dataset.</span>
<span class="sd">            numdays_out (int): Number of forecast days.</span>

<span class="sd">        Returns:</span>
<span class="sd">            U850_cesm_anom (xr.DataArray): Anomalies of u850.</span>
<span class="sd">            U200_cesm_anom (xr.DataArray): Anomalies of u200.</span>
<span class="sd">            OLR_cesm_anom (xr.DataArray): Anomalies of OLR.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">yml_usr_info</span> <span class="o">=</span> <span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;user_defined_info&#39;</span><span class="p">]</span>

        <span class="n">u200vSTR</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u200_name&#39;</span><span class="p">]</span>
        <span class="n">u850vSTR</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u850_name&#39;</span><span class="p">]</span>
        <span class="n">olrvSTR</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_olr_name&#39;</span><span class="p">]</span>
        
        <span class="n">obs_fp_Ec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;obs_data_loc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ERA5_climo.nc&#39;</span><span class="p">)</span>
        <span class="n">ERA5clim</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">obs_fp_Ec</span><span class="p">)</span>
        <span class="n">U850_clim</span><span class="o">=</span><span class="n">ERA5clim</span><span class="p">[</span><span class="s1">&#39;uwnd850&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
        <span class="n">U200_clim</span><span class="o">=</span><span class="n">ERA5clim</span><span class="p">[</span><span class="s1">&#39;uwnd200&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
        <span class="n">OLR_clim</span><span class="o">=</span><span class="n">ERA5clim</span><span class="p">[</span><span class="s1">&#39;olr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>

        <span class="c1">#get the day of year of the forecasts</span>
        <span class="n">fordoy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;time.dayofyear&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1">### OLR ####</span>
            <span class="n">OLRxr</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">olrvSTR</span><span class="p">]</span>
            <span class="n">OLR_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">olrvSTR</span><span class="p">])</span>
            <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLR_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="s1">&#39;olr&#39;</span><span class="p">]),</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">OLR_cesm_anom</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLRxr</span><span class="p">)</span><span class="o">-</span><span class="n">temp_clim_olr</span>

            <span class="c1">### u200 winds ####</span>
            <span class="n">U200_cesm</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">u200vSTR</span><span class="p">]</span>
            <span class="n">U200_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U200_cesm</span><span class="p">)</span>
            <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="s1">&#39;uwnd200&#39;</span><span class="p">]),</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">U200_cesm_anom</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_cesm</span><span class="p">)</span><span class="o">-</span><span class="n">temp_clim_u200</span>

            <span class="c1">### u850 winds ####</span>
            <span class="n">U850_cesm</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">u850vSTR</span><span class="p">]</span>
            <span class="n">U850_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U850_cesm</span><span class="p">)</span>
            <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="s1">&#39;uwnd850&#39;</span><span class="p">]),</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">U850_cesm_anom</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_cesm</span><span class="p">)</span><span class="o">-</span><span class="n">temp_clim_u850</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...we crossed Jan 1...&#39;</span><span class="p">)</span>
            <span class="c1">### OLR ####</span>
            <span class="n">OLRxr</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">olrvSTR</span><span class="p">]</span>
            <span class="n">OLR_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">olrvSTR</span><span class="p">])</span>
            <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLR_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">365</span><span class="p">))[</span><span class="s1">&#39;olr&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLR_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="s1">&#39;olr&#39;</span><span class="p">])],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">temp_clim_olr</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_clim_olr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">numdays_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">temp_clim_olr</span> <span class="o">=</span> <span class="n">temp_clim_olr</span><span class="p">[:,:</span><span class="n">numdays_out</span><span class="p">,:,:]</span>
            <span class="n">OLR_cesm_anom</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLRxr</span><span class="p">)</span><span class="o">-</span><span class="n">temp_clim_olr</span>

            <span class="c1">### u200 winds ####</span>
            <span class="n">U200_cesm</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">u200vSTR</span><span class="p">]</span>
            <span class="n">U200_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U200_cesm</span><span class="p">)</span>
            <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">365</span><span class="p">))[</span><span class="s1">&#39;uwnd200&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="s1">&#39;uwnd200&#39;</span><span class="p">])],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">temp_clim_u200</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_clim_u200</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">numdays_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">temp_clim_u200</span> <span class="o">=</span> <span class="n">temp_clim_u200</span><span class="p">[:,:</span><span class="n">numdays_out</span><span class="p">,:,:]</span>
            <span class="n">U200_cesm_anom</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_cesm</span><span class="p">)</span><span class="o">-</span><span class="n">temp_clim_u200</span>

            <span class="c1">### u850 winds ####</span>
            <span class="n">U850_cesm</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="n">u850vSTR</span><span class="p">]</span>
            <span class="n">U850_cesm_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U850_cesm</span><span class="p">)</span>
            <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">fordoy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">365</span><span class="p">))[</span><span class="s1">&#39;uwnd850&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_clim</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">dayofyear</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">fordoy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="s1">&#39;uwnd850&#39;</span><span class="p">])],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">temp_clim_u850</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_clim_u850</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">numdays_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">temp_clim_u850</span> <span class="o">=</span> <span class="n">temp_clim_u850</span><span class="p">[:,:</span><span class="n">numdays_out</span><span class="p">,:,:]</span>
            <span class="n">U850_cesm_anom</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_cesm</span><span class="p">)</span><span class="o">-</span><span class="n">temp_clim_u850</span>
</div>
        <span class="k">return</span> <span class="n">U850_cesm_anom</span><span class="p">,</span> <span class="n">U200_cesm_anom</span><span class="p">,</span> <span class="n">OLR_cesm_anom</span>



<div class="viewcode-block" id="MJOforecaster.filt_ndays"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.filt_ndays">[docs]</a>    <span class="k">def</span> <span class="nf">filt_ndays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">yml_data</span><span class="p">,</span><span class="n">DS_CESM_for</span><span class="p">,</span><span class="n">U850_cesm_anom</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">,</span><span class="n">OLR_cesm_anom</span><span class="p">,</span><span class="n">DS_climo_forecast</span><span class="p">,</span><span class="n">numdays_out</span><span class="p">,</span><span class="n">AvgdayN</span><span class="p">,</span><span class="n">nensembs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform anomaly filtering for atmospheric variables.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            yml_data (dict): YAML data containing user-defined information.</span>
<span class="sd">            DS_CESM_for: Not defined in the code snippet provided.</span>
<span class="sd">            U850_cesm_anom (xarray.Dataset): Anomaly dataset for U850 variable.</span>
<span class="sd">            U200_cesm_anom (xarray.Dataset): Anomaly dataset for U200 variable.</span>
<span class="sd">            OLR_cesm_anom (xarray.Dataset): Anomaly dataset for OLR variable.</span>
<span class="sd">            DS_climo_forecast: Not defined in the code snippet provided.</span>
<span class="sd">            numdays_out: Not defined in the code snippet provided.</span>
<span class="sd">            AvgdayN: The number of days to be averaged for filtering.</span>
<span class="sd">            nensembs (int): Number of ensemble members.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Updated U850_cesm_anom_filterd, U200_cesm_anom_filterd, OLR_cesm_anom_filterd datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">yml_usr_info</span> <span class="o">=</span> <span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;user_defined_info&#39;</span><span class="p">]</span>

        <span class="c1"># Get variable names from user settings</span>
        <span class="n">u200v</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u200_name&#39;</span><span class="p">]</span>
        <span class="n">u850v</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u850_name&#39;</span><span class="p">]</span>
        <span class="n">olrv</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_olr_name&#39;</span><span class="p">]</span>

        <span class="c1"># Define 120 days prior.</span>
        <span class="n">first_date</span> <span class="o">=</span> <span class="n">U850_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> 
        <span class="n">first_date_120</span> <span class="o">=</span>  <span class="n">U850_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">AvgdayN</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> 

        <span class="c1"># Initialize arrays for filtered anomalies</span>
        <span class="n">U850_cesm_anom_filterd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U850_cesm_anom</span><span class="p">)</span>
        <span class="n">U200_cesm_anom_filterd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U200_cesm_anom</span><span class="p">)</span>
        <span class="n">OLR_cesm_anom_filterd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">OLR_cesm_anom</span><span class="p">)</span>

        <span class="c1">##get obs anomaly...</span>
        <span class="n">obs_fp_MA</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;obs_data_loc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ERA5_Meridional_Mean_Anomaly.nc&#39;</span><span class="p">)</span>
        <span class="n">Obsanom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">obs_fp_MA</span><span class="p">)</span>
        <span class="n">Obsanom</span> <span class="o">=</span> <span class="n">interpolate_obs</span><span class="p">(</span><span class="n">Obsanom</span><span class="p">,</span> <span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
        <span class="n">OLR_anom</span> <span class="o">=</span> <span class="n">Obsanom</span><span class="p">[</span><span class="s1">&#39;olr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;olr&#39;</span><span class="p">:</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_olr_name&#39;</span><span class="p">]})</span>
        <span class="n">U200_anom</span> <span class="o">=</span> <span class="n">Obsanom</span><span class="p">[</span><span class="s1">&#39;uwnd200&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;uwnd200&#39;</span><span class="p">:</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u200_name&#39;</span><span class="p">]})</span>
        <span class="n">U850_anom</span> <span class="o">=</span> <span class="n">Obsanom</span><span class="p">[</span><span class="s1">&#39;uwnd850&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;uwnd850&#39;</span><span class="p">:</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u850_name&#39;</span><span class="p">]})</span>

        <span class="k">for</span> <span class="n">enen</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nensembs</span><span class="p">):</span>
            <span class="c1">### OLR anomaly filtering:</span>
            <span class="n">tmpREolr</span><span class="o">=</span><span class="n">OLR_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">first_date_120</span><span class="p">,</span><span class="n">first_date</span><span class="p">))</span>
            <span class="n">tmpREolr</span><span class="o">=</span><span class="n">tmpREolr</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;dayofyear&#39;</span><span class="p">)</span>
            <span class="n">fused_RE_for_OLR</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tmpREolr</span><span class="p">,</span><span class="n">OLR_cesm_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">fused_RE_for_OLR_rolled</span> <span class="o">=</span> <span class="n">fused_RE_for_OLR</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">OLR_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">OLR_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">OLR_cesm_anom_filterd</span><span class="p">[</span><span class="n">enen</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">OLR_cesm_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">fused_RE_for_OLR_rolled</span><span class="p">[</span><span class="n">olrv</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="c1">### U200 anomaly filtering:</span>
            <span class="n">tmpRE200</span><span class="o">=</span><span class="n">U200_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">first_date_120</span><span class="p">,</span><span class="n">first_date</span><span class="p">))</span>
            <span class="n">tmpRE200</span><span class="o">=</span><span class="n">tmpRE200</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;dayofyear&#39;</span><span class="p">)</span>
            <span class="n">fused_RE_for_200</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tmpRE200</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">fused_RE_for_200_rolled</span> <span class="o">=</span> <span class="n">fused_RE_for_200</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">U200_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">U200_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">U200_cesm_anom_filterd</span><span class="p">[</span><span class="n">enen</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">U200_cesm_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">fused_RE_for_200_rolled</span><span class="p">[</span><span class="n">u200v</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="c1">### U850 anomaly filtering:</span>
            <span class="n">tmpRE850</span><span class="o">=</span><span class="n">U850_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">first_date_120</span><span class="p">,</span><span class="n">first_date</span><span class="p">))</span>
            <span class="n">tmpRE850</span><span class="o">=</span><span class="n">tmpRE850</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;dayofyear&#39;</span><span class="p">)</span>
            <span class="n">fused_RE_for_850</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tmpRE850</span><span class="p">,</span><span class="n">U850_cesm_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">fused_RE_for_850_rolled</span> <span class="o">=</span> <span class="n">fused_RE_for_850</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">U850_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">U850_cesm_anom</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">U850_cesm_anom_filterd</span><span class="p">[</span><span class="n">enen</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">U850_cesm_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">fused_RE_for_850_rolled</span><span class="p">[</span><span class="n">u850v</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</div>
        <span class="k">return</span> <span class="n">OLR_cesm_anom_filterd</span><span class="p">,</span><span class="n">U200_cesm_anom_filterd</span><span class="p">,</span><span class="n">U850_cesm_anom_filterd</span>


<div class="viewcode-block" id="MJOforecaster.project_eofs"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.project_eofs">[docs]</a>    <span class="k">def</span> <span class="nf">project_eofs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">,</span> <span class="n">U850_cesm_anom_filterd</span><span class="p">,</span> <span class="n">U200_cesm_anom_filterd</span><span class="p">,</span> <span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="n">neofs_save</span><span class="p">,</span> <span class="n">neof</span><span class="p">,</span> <span class="n">eof_dict</span><span class="p">,</span><span class="n">svname</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and save RMM indices and EOFs.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            OLR_cesm_anom_filterd (xarray.Dataset): Anomaly dataset for OLR variable.</span>
<span class="sd">            U850_cesm_anom_filterd (xarray.Dataset): Anomaly dataset for U850 variable.</span>
<span class="sd">            U200_cesm_anom_filterd (xarray.Dataset): Anomaly dataset for U200 variable.</span>
<span class="sd">            numdays_out (int): Number of days to project.</span>
<span class="sd">            nensembs (int): Number of ensemble members.</span>
<span class="sd">            neofs_save (int): Number of EOFs to save.</span>
<span class="sd">            neof (int): Number of EOFs to use for RMM calculation.</span>
<span class="sd">            eof_dict (dict): Dictionary containing normalization factors and other parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RMM1 (numpy.ndarray): RMM index 1.</span>
<span class="sd">            RMM2 (numpy.ndarray): RMM index 2.</span>
<span class="sd">            eofs_save (numpy.ndarray): Array of EOFs.</span>
<span class="sd">            sv_olr (numpy.ndarray): Scaled and normalized OLR data.</span>
<span class="sd">            sv_u200 (numpy.ndarray): Scaled and normalized U200 data.</span>
<span class="sd">            sv_u850 (numpy.ndarray): Scaled and normalized U850 data.</span>
<span class="sd">            sv_olr_unscaled (numpy.ndarray): Unscaled OLR data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Unpack the dictionary containing normalization factors and other parameters</span>
        <span class="n">solver</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>
        <span class="n">u200_norm</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;u200_norm&#39;</span><span class="p">]</span>
        <span class="n">u850_norm</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;u850_norm&#39;</span><span class="p">]</span>
        <span class="n">olr_norm</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;olr_norm&#39;</span><span class="p">]</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;loc1&#39;</span><span class="p">]</span>
        <span class="n">loc2</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;loc2&#39;</span><span class="p">]</span>
        <span class="n">scale1</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;scale1&#39;</span><span class="p">]</span>
        <span class="n">scale2</span> <span class="o">=</span> <span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;scale2&#39;</span><span class="p">]</span>

        <span class="n">U850_cesm_anom_filterd_latmean</span> <span class="o">=</span> <span class="n">U850_cesm_anom_filterd</span>
        <span class="n">U200_cesm_anom_filterd_latmean</span> <span class="o">=</span> <span class="n">U200_cesm_anom_filterd</span>
        <span class="n">OLR_cesm_anom_filterd_latmean</span> <span class="o">=</span> <span class="n">OLR_cesm_anom_filterd</span>

        <span class="c1"># Initialize arrays for saving out data</span>
        <span class="n">RMM1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">])</span>
        <span class="n">RMM2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">])</span>
        <span class="n">eofs_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="n">neofs_save</span><span class="p">])</span>
        <span class="n">sv_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>
        <span class="n">sv_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>
        <span class="n">sv_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>
        <span class="n">sv_olr_unscaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>

        <span class="k">for</span> <span class="n">enen</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nensembs</span><span class="p">):</span>
            <span class="c1"># Normalize the anomaly data</span>
            <span class="n">forc_u200_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span> <span class="o">/</span> <span class="n">u200_norm</span><span class="p">)</span>
            <span class="n">forc_u850_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U850_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span> <span class="o">/</span> <span class="n">u850_norm</span><span class="p">)</span>
            <span class="n">forc_olr_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">enen</span><span class="p">)</span> <span class="o">/</span> <span class="n">olr_norm</span><span class="p">)</span>
            <span class="n">forc_olr_norm</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">forc_u200_norm</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">forc_u850_norm</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">neof</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">neofs_save</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="n">pj_sub</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">projectField</span><span class="p">([</span><span class="n">forc_olr_norm</span><span class="p">,</span> <span class="n">forc_u850_norm</span><span class="p">,</span> <span class="n">forc_u200_norm</span><span class="p">],</span> <span class="n">neofs</span><span class="o">=</span><span class="n">neofs_save</span><span class="p">)</span>
            <span class="n">pj_saver_normalized</span> <span class="o">=</span> <span class="n">pj_sub</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="n">neofs_save</span><span class="p">])</span>
            <span class="n">pj_sub</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">neof</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="n">neof</span><span class="p">])</span>
            <span class="n">RMM1</span><span class="p">[:,</span> <span class="n">enen</span><span class="p">]</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="p">[:,</span> <span class="n">loc1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale1</span><span class="p">)</span>
            <span class="n">RMM2</span><span class="p">[:,</span> <span class="n">enen</span><span class="p">]</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="p">[:,</span> <span class="n">loc2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale2</span><span class="p">)</span>  <span class="c1"># I think this is right</span>

            <span class="n">sv_olr</span><span class="p">[:,</span> <span class="n">enen</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">forc_olr_norm</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">sv_u200</span><span class="p">[:,</span> <span class="n">enen</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">forc_u200_norm</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">sv_u850</span><span class="p">[:,</span> <span class="n">enen</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">forc_u850_norm</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">eofs_save</span><span class="p">[:,</span> <span class="n">enen</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pj_saver_normalized</span>

        <span class="c1">###ensemble mean####</span>
        <span class="n">forc_u200_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">U200_cesm_anom_filterd_latmean</span><span class="o">/</span><span class="n">u200_norm</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;ensemble&#39;</span><span class="p">))</span>
        <span class="n">forc_u850_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">U850_cesm_anom_filterd_latmean</span><span class="o">/</span><span class="n">u850_norm</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;ensemble&#39;</span><span class="p">))</span>
        <span class="n">forc_olr_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">/</span><span class="n">olr_norm</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;ensemble&#39;</span><span class="p">))</span>   
        <span class="n">forc_olr_norm</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">forc_u200_norm</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">forc_u850_norm</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">pj_sub</span><span class="o">=</span><span class="n">solver</span><span class="o">.</span><span class="n">projectField</span><span class="p">([</span><span class="n">forc_olr_norm</span><span class="p">,</span> <span class="n">forc_u850_norm</span><span class="p">,</span> <span class="n">forc_u200_norm</span><span class="p">],</span><span class="n">neofs</span><span class="o">=</span><span class="n">neofs_save</span><span class="p">)</span>
        <span class="n">pj_saver_normalized</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="n">neofs_save</span><span class="p">])</span>
        <span class="n">pj_sub</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">neof</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="n">neof</span><span class="p">])</span>
        <span class="n">RMM1_emean</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="p">[:,</span><span class="n">loc1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">scale1</span><span class="p">)</span> 
        <span class="n">RMM2_emean</span> <span class="o">=</span> <span class="n">pj_sub</span><span class="p">[:,</span><span class="n">loc2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">scale2</span><span class="p">)</span>  <span class="c1">### I think this is right</span>
        <span class="c1">###ensemble mean####</span>

        <span class="c1">#grab the obs fields:</span>
        <span class="n">obs_olr_norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="o">.</span><span class="n">olr_norm</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">obs_u850_norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="o">.</span><span class="n">u850_norm</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">obs_u200_norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="o">.</span><span class="n">u200_norm</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>

        <span class="n">pj_sub_obs</span><span class="o">=</span><span class="n">solver</span><span class="o">.</span><span class="n">projectField</span><span class="p">([</span><span class="n">obs_olr_norm</span><span class="p">,</span> <span class="n">obs_u850_norm</span><span class="p">,</span> <span class="n">obs_u200_norm</span><span class="p">],</span><span class="n">neofs</span><span class="o">=</span><span class="n">neof</span><span class="p">)</span>
        <span class="n">pj_sub_obs</span><span class="o">=</span><span class="n">pj_sub_obs</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">RMM1_obs_cera20c</span> <span class="o">=</span> <span class="n">pj_sub_obs</span><span class="p">[:,</span><span class="n">loc1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">scale1</span><span class="p">)</span> 
        <span class="n">RMM2_obs_cera20c</span> <span class="o">=</span> <span class="n">pj_sub_obs</span><span class="p">[:,</span><span class="n">loc2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">scale2</span><span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">save_out_forecast_nc</span><span class="p">(</span><span class="n">RMM1</span><span class="p">,</span><span class="n">RMM2</span><span class="p">,</span><span class="n">RMM1_emean</span><span class="p">,</span><span class="n">RMM2_emean</span><span class="p">,</span><span class="n">RMM1_obs_cera20c</span><span class="p">,</span><span class="n">RMM2_obs_cera20c</span><span class="p">,</span><span class="n">eofs_save</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span>
                             <span class="p">,</span><span class="n">sv_olr</span><span class="p">,</span><span class="n">sv_u200</span><span class="p">,</span><span class="n">sv_u850</span><span class="p">,</span><span class="n">eof_dict</span><span class="p">,</span><span class="n">neofs_save</span><span class="p">,</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="p">,</span><span class="n">svname</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">,</span><span class="n">U200_cesm_anom_filterd</span><span class="p">)</span>
</div>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="MJOforecaster.save_out_forecast_nc"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.save_out_forecast_nc">[docs]</a>    <span class="k">def</span> <span class="nf">save_out_forecast_nc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">RMM1</span><span class="p">,</span><span class="n">RMM2</span><span class="p">,</span><span class="n">RMM1_emean</span><span class="p">,</span><span class="n">RMM2_emean</span><span class="p">,</span><span class="n">RMM1_obs_cera20c</span><span class="p">,</span><span class="n">RMM2_obs_cera20c</span><span class="p">,</span><span class="n">eofs_save</span><span class="p">,</span><span class="n">MJO_fobs</span><span class="p">,</span>
                             <span class="n">sv_olr</span><span class="p">,</span><span class="n">sv_u200</span><span class="p">,</span><span class="n">sv_u850</span><span class="p">,</span><span class="n">eof_dict</span><span class="p">,</span><span class="n">neofs_save</span><span class="p">,</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="p">,</span><span class="n">svname</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">,</span><span class="n">U200_cesm_anom_filterd</span><span class="p">):</span>

        <span class="n">solver</span><span class="o">=</span><span class="n">eof_dict</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>

        <span class="n">MJO_for</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;RMM1&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;number&quot;</span><span class="p">],</span><span class="n">RMM1</span><span class="p">),</span>
            <span class="s2">&quot;RMM2&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;number&quot;</span><span class="p">],</span><span class="n">RMM2</span><span class="p">),</span>
            <span class="s2">&quot;RMM1_emean&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span><span class="n">RMM1_emean</span><span class="p">),</span>
            <span class="s2">&quot;RMM2_emean&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span><span class="n">RMM2_emean</span><span class="p">),</span>
            <span class="s2">&quot;RMM1_obs&quot;</span><span class="p">:([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span><span class="n">RMM1_obs_cera20c</span><span class="p">),</span>
            <span class="s2">&quot;RMM2_obs&quot;</span><span class="p">:([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span><span class="n">RMM2_obs_cera20c</span><span class="p">),</span>
            <span class="s2">&quot;eofs_save&quot;</span><span class="p">:([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="s1">&#39;neigs&#39;</span><span class="p">],</span><span class="n">eofs_save</span><span class="p">),</span>
            <span class="s2">&quot;OLR_norm&quot;</span><span class="p">:([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">sv_olr</span><span class="p">),</span> 
            <span class="s2">&quot;eof1_olr&quot;</span><span class="p">:([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="p">[</span><span class="s1">&#39;eof1_olr&#39;</span><span class="p">])),</span>
            <span class="s2">&quot;eof2_olr&quot;</span><span class="p">:([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="p">[</span><span class="s1">&#39;eof2_olr&#39;</span><span class="p">])),</span>
            <span class="s2">&quot;eof1_u850&quot;</span><span class="p">:([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="p">[</span><span class="s1">&#39;eof1_u850&#39;</span><span class="p">])),</span>
            <span class="s2">&quot;eof2_u850&quot;</span><span class="p">:([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="p">[</span><span class="s1">&#39;eof2_u850&#39;</span><span class="p">])),</span>
            <span class="s2">&quot;eof1_u200&quot;</span><span class="p">:([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="p">[</span><span class="s1">&#39;eof2_u200&#39;</span><span class="p">])),</span>
            <span class="s2">&quot;eof2_u200&quot;</span><span class="p">:([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJO_fobs</span><span class="p">[</span><span class="s1">&#39;eof2_u200&#39;</span><span class="p">])),</span>
            <span class="s2">&quot;u200_norm&quot;</span><span class="p">:([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">sv_u200</span><span class="p">),</span> 
            <span class="s2">&quot;u850_norm&quot;</span><span class="p">:([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">sv_u850</span><span class="p">),</span>
            <span class="s2">&quot;U200_cesm_anom&quot;</span><span class="p">:([</span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_cesm_anom</span><span class="p">)),</span> 
            <span class="s2">&quot;U200_cesm_anom_filterd&quot;</span><span class="p">:([</span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U200_cesm_anom_filterd</span><span class="p">)),</span> 
            <span class="s2">&quot;eig_vals&quot;</span><span class="p">:([</span><span class="s1">&#39;neigs&#39;</span><span class="p">],</span><span class="n">solver</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">(</span><span class="n">neigs</span><span class="o">=</span><span class="n">neofs_save</span><span class="p">))</span>

        <span class="p">},</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd_latmean</span><span class="o">.</span><span class="n">lon</span><span class="p">),</span>
            <span class="s2">&quot;neigs&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">neofs_save</span><span class="p">)</span>
        <span class="p">},)</span>


        <span class="n">MJO_for</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CESM2 - MJO RMM Forecast eof(u850,u200,OLR)&quot;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MJO Forecast in the Prescribed Forecast dataset calculated as in Wheeler and Hendon 2004, a 120-day filter, 15S-15N averaged variables &quot;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;notes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; ONLY Variables RMM1 and RMM2 have been flipped and switched -from eofs_save- to match standard MJO conventions&quot;</span>

        <span class="n">MJO_for</span><span class="o">.</span><span class="n">RMM1</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stddev&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">RMM1</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;RMM1&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">RMM1</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;RMM1&#39;</span>

        <span class="n">MJO_for</span><span class="o">.</span><span class="n">RMM2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stddev&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">RMM2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;RMM2&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">RMM2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;RMM2&#39;</span>

        <span class="n">MJO_for</span><span class="o">.</span><span class="n">OLR_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stddev&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">OLR_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;OLR - normalized&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">OLR_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;OLR - normalized&#39;</span>

        <span class="n">MJO_for</span><span class="o">.</span><span class="n">u200_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stddev&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">u200_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;u200 normalized&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">u200_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;u200 normalized&#39;</span>

        <span class="n">MJO_for</span><span class="o">.</span><span class="n">u850_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stddev&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">u850_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;u200 normalized&#39;</span>
        <span class="n">MJO_for</span><span class="o">.</span><span class="n">u850_norm</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;u200 normalized&#39;</span>

        <span class="n">MJO_for</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">svname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved: &#39;</span><span class="p">,</span><span class="n">svname</span><span class="p">)</span>  </div>
        <span class="bp">self</span><span class="o">.</span><span class="n">MJO_forecast_DS</span> <span class="o">=</span> <span class="n">MJO_for</span>



<div class="viewcode-block" id="MJOforecaster.check_forecast_files_runtime"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.check_forecast_files_runtime">[docs]</a>    <span class="k">def</span> <span class="nf">check_forecast_files_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">for_file_list</span><span class="p">,</span> <span class="n">yml_usr_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the forecast files for required variables and ensemble dimension.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            for_file_list (str): File path of the forecast file to be checked.</span>
<span class="sd">            yml_usr_info (dict): Dictionary containing user settings from YAML file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Bingo (bool): True if the required variables are present, False otherwise.</span>
<span class="sd">            DS (xarray.Dataset): Updated dataset with added &#39;ensemble&#39; dimension (if required).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">convert_dates_to_string</span><span class="p">(</span><span class="n">for_file_list</span><span class="p">)</span>
        <span class="c1"># Open the forecast file as an xarray dataset</span>
        <span class="n">DS</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">for_file_list</span><span class="p">)</span>

        <span class="c1">#check for lat lon</span>
        <span class="n">CheckMinLatLon</span> <span class="o">=</span> <span class="n">check_lat_lon_coords</span><span class="p">(</span><span class="n">DS</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">CheckMinLatLon</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;the files MUST contain either a lat/lon or latitude/longitude coordinate&quot;</span><span class="p">)</span> 

        <span class="c1">#change variable name if necessary</span>
        <span class="k">if</span> <span class="s1">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">DS</span> <span class="o">=</span> <span class="n">DS</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="s1">&#39;lat&#39;</span><span class="p">})</span>

        <span class="c1">#flip the orientation of the xarray if necessary </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">DS</span> <span class="o">=</span> <span class="n">flip_lat_if_necessary</span><span class="p">(</span><span class="n">DS</span><span class="p">)</span>
            <span class="n">DS</span> <span class="o">=</span> <span class="n">switch_lon_to_0_360</span><span class="p">(</span><span class="n">DS</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;it broke while re-orienting your forecast files to be S-&gt;N and 0-360 degrees lon&quot;</span><span class="p">)</span> 

        <span class="c1"># Get variable names from user settings</span>
        <span class="n">u200v</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u200_name&#39;</span><span class="p">]</span>
        <span class="n">u850v</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_u850_name&#39;</span><span class="p">]</span>
        <span class="n">olrv</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_olr_name&#39;</span><span class="p">]</span>

        <span class="c1"># Check if required variables are present in the dataset</span>
        <span class="k">if</span> <span class="n">u200v</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span> <span class="n">u850v</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span> <span class="n">olrv</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">Bingo</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;it looks like the defined u200,u850,or olr variables are not present in the file&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&#39;</span><span class="p">)</span>
            <span class="n">Bingo</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Get the ensemble dimension name from user settings</span>
        <span class="n">ensemble_name</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_ensemble_dimension_name&#39;</span><span class="p">]</span>

        <span class="c1"># Check if the ensemble dimension is already present in the dataset</span>
        <span class="k">if</span> <span class="n">ensemble_name</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ensemble dimension length:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">ensemble_name</span><span class="p">]))</span>
            <span class="n">ense_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">ensemble_name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the ensemble dimension is not present, try to add it</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Create an &#39;ensemble&#39; coordinate array and assign it to the dataset</span>
                <span class="n">DS</span> <span class="o">=</span> <span class="n">DS</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="n">ensemble_name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">ensemble_name</span><span class="p">]))})</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expanding coords to include ensemble&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ensemble dimension length:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">ensemble_name</span><span class="p">]))</span>
                <span class="n">ense_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">ensemble_name</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># If there is an error, add &#39;ensemble&#39; as a new dimension to the dataset</span>
                <span class="n">ensemble_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">DS</span> <span class="o">=</span> <span class="n">DS</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">ensemble_values</span><span class="p">)</span>
                <span class="c1"># Assign the coordinate values for the new &#39;ensemble&#39; dimension</span>
                <span class="n">DS</span> <span class="o">=</span> <span class="n">DS</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">ensemble</span><span class="o">=</span><span class="n">ensemble_values</span><span class="p">)</span>
                <span class="n">ense_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">DS</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;there are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="s1">&#39;time.dayofyear&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> forecast lead days in these files&quot;</span><span class="p">)</span>
            <span class="n">leaddays</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="s1">&#39;time.dayofyear&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;the files MUST be compatible with xarray&#39;s DS[&#39;time.dayofyear&#39;] functionality&quot;</span><span class="p">)</span>
</div>
        <span class="k">return</span> <span class="n">Bingo</span><span class="p">,</span> <span class="n">DS</span><span class="p">,</span> <span class="n">ense_length</span><span class="p">,</span> <span class="n">leaddays</span>


<div class="viewcode-block" id="MJOforecaster.create_forecasts"><a class="viewcode-back" href="../../../MJOcast.utils.html#MJOcast.utils.ProcessForecasts.MJOforecaster.create_forecasts">[docs]</a>    <span class="k">def</span> <span class="nf">create_forecasts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to create forecast files for a given range of latitude and settings.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            yml_data (dict): Data dictionary containing forecast information.</span>
<span class="sd">            lons_forecasts (list): List of longitudes for the forecast.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DS_CESM_for (xr.Dataset): Forecast dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Settings</span>
        <span class="n">latwant</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">]</span>  <span class="c1"># Latitudinal range</span>
        <span class="n">AvgdayN</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># Filtering average</span>
        <span class="n">neof</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Number of EOFs (RMM indices)</span>
        <span class="n">neofs_save</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># Number of total PCs to save</span>

        <span class="c1"># Extract information from the data dictionary</span>
        <span class="n">yml_usr_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yml_data</span><span class="p">[</span><span class="s1">&#39;user_defined_info&#39;</span><span class="p">]</span>
        <span class="n">datadir_Uwind</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_data_loc&#39;</span><span class="p">]</span>

        <span class="c1"># Get filenames in a dataframe</span>
        <span class="n">FN_Uwind</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_data_loc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_data_name_str&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">FN_Uwind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files &#39;</span><span class="si">{</span><span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;forecast_data_name_str&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; do not exist... &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;check your datestring of the filenames.&quot;</span><span class="p">)</span>

        <span class="c1">#get the driver dataframe</span>
        <span class="n">DF_Uwind</span> <span class="o">=</span> <span class="n">make_DF_ense</span><span class="p">(</span><span class="n">FN_Uwind</span><span class="p">)</span>

        <span class="c1">#get the climatology to create the anomalies</span>
        <span class="n">DS_climo_forecast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_forecast_LT_climo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yml_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_lons</span><span class="p">)</span>

        <span class="c1">#loop to make each forecast file:</span>
        <span class="k">for</span> <span class="n">FileCounter</span><span class="p">,</span> <span class="n">eee</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DF_Uwind</span><span class="p">))):</span>
            
            <span class="n">svname</span> <span class="o">=</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;output_files_loc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;output_files_string&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">DF_Uwind</span><span class="p">[</span><span class="s1">&#39;Init&#39;</span><span class="p">][</span><span class="n">eee</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.nc&#39;</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">svname</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">svname</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The above forecast file already exists... Im skipping it... erase it if you want to make it again&#39;</span><span class="p">)</span>
                <span class="k">continue</span>  <span class="c1"># Skip to the next iteration if the file exists</span>

            <span class="c1">#Load check and adjust the forecast file and get key variables</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading forecasts file:&#39;</span><span class="p">,</span> <span class="n">DF_Uwind</span><span class="p">[</span><span class="s1">&#39;File&#39;</span><span class="p">][</span><span class="n">eee</span><span class="p">])</span>
            <span class="n">Bingo</span><span class="p">,</span> <span class="n">DS_CESM_for</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="n">numdays_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_forecast_files_runtime</span><span class="p">(</span><span class="n">DF_Uwind</span><span class="p">[</span><span class="s1">&#39;File&#39;</span><span class="p">][</span><span class="n">eee</span><span class="p">],</span> <span class="n">yml_usr_info</span><span class="p">)</span>   


            <span class="n">DS_CESM_for</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span> <span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">latwant</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">latwant</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">DS_CESM_for</span> <span class="o">=</span> <span class="n">DS_CESM_for</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>

            <span class="c1">#initialize the files to save out:</span>
            <span class="n">RMM1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">])</span>
            <span class="n">RMM2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">])</span>
            <span class="n">eofs_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="n">neofs_save</span><span class="p">])</span>
            <span class="n">sv_olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>
            <span class="n">sv_u200</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>
            <span class="n">sv_u850</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>
            <span class="n">sv_olr_unscaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numdays_out</span><span class="p">,</span> <span class="n">nensembs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DS_CESM_for</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])])</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- doing anomaly ----&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yml_usr_info</span><span class="p">[</span><span class="s1">&#39;use_forecast_climo&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;im using the LT dp climo&#39;</span><span class="p">)</span>
                    <span class="n">U850_cesm_anom</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">,</span><span class="n">OLR_cesm_anom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anomaly_LTD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yml_data</span><span class="p">,</span><span class="n">DS_CESM_for</span><span class="p">,</span><span class="n">DS_climo_forecast</span><span class="p">,</span><span class="n">numdays_out</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">U850_cesm_anom</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">,</span><span class="n">OLR_cesm_anom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anomaly_ERA5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yml_data</span><span class="p">,</span><span class="n">DS_CESM_for</span><span class="p">,</span><span class="n">DS_climo_forecast</span><span class="p">,</span><span class="n">numdays_out</span><span class="p">)</span>
                <span class="c1">#function to run the anomaly... get_forecast_anom(yml_data,DS_CESM_for,DS_climo_forecast)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;error happened while computing forecast runtime anomaly.. check the get_forecast_anom() function&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- done computing the anomaly----&#39;</span><span class="p">)</span>


            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--- filter out 120 days ---&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">OLR_cesm_anom_filterd</span><span class="p">,</span><span class="n">U200_cesm_anom_filterd</span><span class="p">,</span><span class="n">U850_cesm_anom_filterd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_ndays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yml_data</span><span class="p">,</span>
                                                                                                    <span class="n">DS_CESM_for</span><span class="p">,</span>
                                                                                                    <span class="n">U850_cesm_anom</span><span class="p">,</span>
                                                                                                    <span class="n">U200_cesm_anom</span><span class="p">,</span>
                                                                                                    <span class="n">OLR_cesm_anom</span><span class="p">,</span><span class="n">DS_climo_forecast</span><span class="p">,</span>
                                                                                                    <span class="n">numdays_out</span><span class="p">,</span><span class="n">AvgdayN</span><span class="p">,</span><span class="n">nensembs</span><span class="p">)</span>
                <span class="c1">#function to run the anomaly... get_forecast_anom(yml_data,DS_CESM_for,DS_climo_forecast,MJO_for_obs)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;error happened while computing filtering out the previous days.. check the filter_previous_days() function&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--- done filtering out 120 days ---&#39;</span><span class="p">)</span>


            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--- project the EOFS ---&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_eofs</span><span class="p">(</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">,</span>
                                  <span class="n">U850_cesm_anom_filterd</span><span class="p">,</span>
                                  <span class="n">U200_cesm_anom_filterd</span><span class="p">,</span>
                                  <span class="n">numdays_out</span><span class="p">,</span><span class="n">nensembs</span><span class="p">,</span>
                                  <span class="n">neofs_save</span><span class="p">,</span><span class="n">neof</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">eof_dict</span><span class="p">,</span>
                                  <span class="n">svname</span><span class="p">,</span><span class="n">U200_cesm_anom</span><span class="p">)</span>
                <span class="c1">#function to run the anomaly... get_forecast_anom(yml_data,DS_CESM_for,DS_climo_forecast,MJO_for_obs)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;error happened while computing filtering out the previous days.. check the filter_previous_days() function&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--- done projecting the EOFS ---&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">DS_for</span> <span class="o">=</span> <span class="n">DS_CESM_for</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OLR_anom_filtered</span> <span class="o">=</span> <span class="n">OLR_cesm_anom_filterd</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">U200_anom_filtered</span> <span class="o">=</span> <span class="n">U200_cesm_anom_filterd</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">U850_anom_filtered</span> <span class="o">=</span> <span class="n">U850_cesm_anom_filterd</span>
            
</div></div>
        <span class="k">return</span> <span class="n">DS_CESM_for</span><span class="p">,</span><span class="n">OLR_cesm_anom_filterd</span><span class="p">,</span><span class="n">U200_cesm_anom_filterd</span><span class="p">,</span><span class="n">U850_cesm_anom_filterd</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, Will Chapman.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>